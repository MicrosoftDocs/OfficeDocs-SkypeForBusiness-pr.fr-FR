---
title: 'Lync Server 2013 : vue d’ensemble du service de journalisation centralisé'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Overview of the Centralized Logging Service
ms:assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688145(v=OCS.15)
ms:contentKeyID: 49733746
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 1460699b6516ab4e510c9715b2464ce442466faa
ms.sourcegitcommit: b693d5923d6240cbb865241a5750963423a4b33e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/04/2020
ms.locfileid: "41755448"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="overview-of-the-centralized-logging-service-in-lync-server-2013"></a><span data-ttu-id="41f13-102">Présentation du service de journalisation centralisé dans Lync Server 2013</span><span class="sxs-lookup"><span data-stu-id="41f13-102">Overview of the Centralized Logging Service in Lync Server 2013</span></span>

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

<span data-ttu-id="41f13-103">_**Dernière modification de la rubrique :** 2013-02-22_</span><span class="sxs-lookup"><span data-stu-id="41f13-103">_**Topic Last Modified:** 2013-02-22_</span></span>

<span data-ttu-id="41f13-104">Le service de journalisation centralisé a pour but de fournir un moyen de contrôler la collecte de données, avec une étendue générale ou étroite.</span><span class="sxs-lookup"><span data-stu-id="41f13-104">The Centralized Logging Service is designed to provide a means for controlled collection of data—with a broad or narrow scope.</span></span> <span data-ttu-id="41f13-105">Vous pouvez recueillir des données à partir de tous les serveurs dans le déploiement de façon simultanée, définir des éléments spécifiques pour suivre, définir des indicateurs de trace et retourner des résultats de recherche à partir d’un ordinateur unique ou d’une agrégation de toutes les données de tous les serveurs.</span><span class="sxs-lookup"><span data-stu-id="41f13-105">You can collect data from all servers in the deployment concurrently, define specific elements to trace, set trace flags and return search results from a single computer or an aggregation of all data from all servers.</span></span> <span data-ttu-id="41f13-106">Le service de journalisation centralisé s’exécute sur tous les serveurs dans votre déploiement.</span><span class="sxs-lookup"><span data-stu-id="41f13-106">The Centralized Logging Service runs on all servers in your deployment.</span></span> <span data-ttu-id="41f13-107">L’architecture du service de journalisation centralisé est composée des agents et services suivants :</span><span class="sxs-lookup"><span data-stu-id="41f13-107">The architecture of the Centralized Logging Service is comprised of the following agents and services:</span></span>

  - <span data-ttu-id="41f13-108">*Agent de service de journalisation centralisé*   ClsAgent. exe est l’exécutable du service qui communique avec le contrôleur et reçoit les commandes émises par l’administrateur.</span><span class="sxs-lookup"><span data-stu-id="41f13-108">*Centralized Logging Service Agent*   ClsAgent.exe is the service executable that communicates with the controller and receives the commands that the controller is issued by the administrator.</span></span> <span data-ttu-id="41f13-109">L’agent s’exécute en tant que service sur chaque ordinateur Lync Server.</span><span class="sxs-lookup"><span data-stu-id="41f13-109">The agent is run as a service on each Lync Server computer.</span></span> <span data-ttu-id="41f13-110">Lorsque l’agent reçoit une commande, il exécute la commande, envoie des messages aux composants définis pour le suivi et écrit les journaux de suivi sur le disque.</span><span class="sxs-lookup"><span data-stu-id="41f13-110">When the agent receives a command, it executes the command, sends messages to the defined components for tracing, and writes the trace logs to disk.</span></span> <span data-ttu-id="41f13-111">Il lit également les journaux de suivi pour son ordinateur et renvoie les données de suivi au contrôleur lorsque cela est demandé.</span><span class="sxs-lookup"><span data-stu-id="41f13-111">It also reads the trace logs for its computer and sends the trace data back to the controller when requested.</span></span> <span data-ttu-id="41f13-112">Le ClsAgent écoute les commandes sur les ports suivants : **tcp 50001**, **TCP 50002**et **TCP 50003**.</span><span class="sxs-lookup"><span data-stu-id="41f13-112">The ClsAgent listens for commands on the following ports: **TCP 50001**, **TCP 50002**, and **TCP 50003**.</span></span>

  - <span data-ttu-id="41f13-113">*Contrôleur de service de journalisation centralisé*   ClsControllerLib. dll est le moteur d’exécution de commandes pour Lync Server Management Shell et ClsController. exe.</span><span class="sxs-lookup"><span data-stu-id="41f13-113">*Centralized Logging Service Controller*   ClsControllerLib.dll is the command execution engine for the Lync Server Management Shell and for ClsController.exe.</span></span> <span data-ttu-id="41f13-114">CLSControllerLib. dll envoie des commandes de démarrage, d’arrêt, de vidage et de recherche à ClsAgent.</span><span class="sxs-lookup"><span data-stu-id="41f13-114">CLSControllerLib.dll sends Start, Stop, Flush, and Search commands to the ClsAgent.</span></span> <span data-ttu-id="41f13-115">Lorsque les commandes de recherche sont envoyées, les journaux obtenus sont renvoyés à ClsControllerLib. dll et agrégés.</span><span class="sxs-lookup"><span data-stu-id="41f13-115">When search commands are sent, the resulting logs are returned to the ClsControllerLib.dll and aggregated.</span></span> <span data-ttu-id="41f13-116">Le contrôleur est chargé d’envoyer des commandes à l’agent, de recevoir l’état de ces commandes et de gérer les données du fichier du journal de recherche tel qu’il est renvoyé par tous les agents sur n’importe quel ordinateur dans l’étendue de la recherche, puis de regrouper les données du journal dans un ordre significatif et indiqué. jeu de sorties.</span><span class="sxs-lookup"><span data-stu-id="41f13-116">The controller is responsible for sending commands to the agent, receiving the status of those commands and managing the search log file data as it is returned from all agents on any computer in the search scope, and aggregating the log data into a meaningful and ordered output set.</span></span> <span data-ttu-id="41f13-117">Les informations des rubriques suivantes portent sur l’utilisation de Lync Server Management Shell.</span><span class="sxs-lookup"><span data-stu-id="41f13-117">The information in the following topics is focused on using the Lync Server Management Shell.</span></span> <span data-ttu-id="41f13-118">ClsController. exe est limité à un sous-ensemble des fonctions et fonctions disponibles dans Lync Server Management Shell.</span><span class="sxs-lookup"><span data-stu-id="41f13-118">ClsController.exe is limited to a subset of the features and functions that are available in the Lync Server Management Shell.</span></span> <span data-ttu-id="41f13-119">Pour obtenir de l’aide sur ClsController. exe, accédez à la `ClsController` ligne de commande en tapant dans\\le répertoire\\par défaut\\C : fichiers fichiers\\communs Microsoft Lync Server 2013 ClsAgent.</span><span class="sxs-lookup"><span data-stu-id="41f13-119">Help for ClsController.exe is available at the command line by typing `ClsController` in the default directory C:\\Program Files\\Common Files\\Microsoft Lync Server 2013\\ClsAgent.</span></span>

<span data-ttu-id="41f13-120">**Communications entre ClsController et ClsAgent**</span><span class="sxs-lookup"><span data-stu-id="41f13-120">**ClsController communications to ClsAgent**</span></span>

<span data-ttu-id="41f13-121">![Relation entre CLSController et CLSAgent.](images/JJ688145.68c90811-5cf9-4a84-95b7-ea9ffc61eac4(OCS.15).jpg "Relation entre CLSController et CLSAgent.")</span><span class="sxs-lookup"><span data-stu-id="41f13-121">![Relationship between CLSController and CLSAgent.](images/JJ688145.68c90811-5cf9-4a84-95b7-ea9ffc61eac4(OCS.15).jpg "Relationship between CLSController and CLSAgent.")</span></span>

<span data-ttu-id="41f13-122">Vous émettez des commandes à l’aide de l’interface de ligne de commande Windows Server ou de Lync Server Management Shell.</span><span class="sxs-lookup"><span data-stu-id="41f13-122">You issue commands using the Windows Server command-line interface or using the Lync Server Management Shell.</span></span> <span data-ttu-id="41f13-123">Les commandes sont exécutées sur lʼordinateur auquel vous êtes connecté et envoyées au ClsAgent localement ou à dʼautres ordinateurs et pools dans votre déploiement.</span><span class="sxs-lookup"><span data-stu-id="41f13-123">The commands are executed on the computer you are logged in to and sent to the ClsAgent locally or to the other computers and pools in your deployment.</span></span>

<span data-ttu-id="41f13-124">ClsAgent maintient un fichier d’index de tous les fichiers .CACHE dont il dispose sur l’ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="41f13-124">ClsAgent maintains an index file of all .CACHE files that it has on the local machine.</span></span> <span data-ttu-id="41f13-125">ClsAgent les alloue de sorte qu’ils soient distribuées de manière égale parmi les volumes définis par l’option CacheFileLocalFolders, en ne consommant jamais plus de 80 % de chaque volume (autrement dit, l’emplacement du cache local et le pourcentage sont configurables à l’aide de l’applet de commande  **Set-CsClsConfiguration**).</span><span class="sxs-lookup"><span data-stu-id="41f13-125">ClsAgent allocates them so that they are evenly distributed across volumes defined by the option CacheFileLocalFolders, never consuming more than 80% of each volume (that is, the local cache location and the percentage is configurable using the **Set-CsClsConfiguration** cmdlet).</span></span> <span data-ttu-id="41f13-126">ClsAgent est également responsable de la suppression des anciens fichiers journaux de suivi d’événements mis en cache (.etl) sur l’ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="41f13-126">ClsAgent is also responsible for aging old cached event trace log (.etl) files off the local machine.</span></span> <span data-ttu-id="41f13-127">Après deux semaines (le délai est configurable à l’aide de l’applet de commande  **Set-CsClsConfiguration**), ces fichiers sont copiés sur un partage de fichiers et supprimés de l’ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="41f13-127">After two weeks (that is, the timeframe is configurable using the **Set-CsClsConfiguration** cmdlet) these files are copied to a file share and deleted from the local computer.</span></span> <span data-ttu-id="41f13-128">Pour plus d’informations, voir [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/Set-CsClsConfiguration).</span><span class="sxs-lookup"><span data-stu-id="41f13-128">For details, see [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/Set-CsClsConfiguration).</span></span> <span data-ttu-id="41f13-129">Lors de la réception d’une demande de recherche, les critères de recherche sont utilisés pour sélectionner le jeu de fichiers .etl mis en cache afin d’effectuer la recherche en fonction des valeurs dans l’index conservé par l’agent.</span><span class="sxs-lookup"><span data-stu-id="41f13-129">When a search request is received, the search criteria is used to select the set of cached .etl files to perform the search based on the values in the index maintained by the agent.</span></span>

<div>


> [!NOTE]  
> <span data-ttu-id="41f13-p106">Les fichiers déplacés vers le partage de fichiers à partir de l’ordinateur local peuvent être consultés par ClsAgent. Une fois que ClsAgent a déplacé les fichiers vers le partage, le vieillissement et la suppression des fichiers ne sont pas conservés par ClsAgent. Vous devez définir une tâche d’administration pour contrôler la taille des fichiers sur le partage de fichiers et les supprimer ou les archiver.</span><span class="sxs-lookup"><span data-stu-id="41f13-p106">Files that are moved to the file share from the local computer can be searched by ClsAgent. Once ClsAgent moves the files to the file share, the aging and removal of files is not maintained by ClsAgent. You should define an administrative task to monitor the size of the files in the file share and delete them or archive them.</span></span>



</div>

<span data-ttu-id="41f13-133">Les fichiers journaux résultants peuvent être lus et analysés à l’aide de divers outils, notamment **Snooper.exe** et tout outil capable de lire un fichier texte, tel que **Notepad.exe**.</span><span class="sxs-lookup"><span data-stu-id="41f13-133">The resulting log files can be read and analyzed using a variety of tools, including **Snooper.exe** and any tool that can read a text file, such as **Notepad.exe**.</span></span> <span data-ttu-id="41f13-134">Snooper. exe fait partie des outils de débogage de Lync Server 2013 et est disponible en téléchargement sur [http://go.microsoft.com/fwlink/?LinkId=285257](http://go.microsoft.com/fwlink/?linkid=285257)le Web.</span><span class="sxs-lookup"><span data-stu-id="41f13-134">Snooper.exe is part of the Lync Server 2013 Debug Tools and is available as a Web download from [http://go.microsoft.com/fwlink/?LinkId=285257](http://go.microsoft.com/fwlink/?linkid=285257).</span></span>

<span data-ttu-id="41f13-135">Comme OCSLogger, le service de journalisation centralisé dispose de plusieurs composants à suivre, et fournit des options permettant de sélectionner des indicateurs\_, tels que\_le composant TF et TF diag.</span><span class="sxs-lookup"><span data-stu-id="41f13-135">Like OCSLogger, the Centralized Logging Service has several components to trace against, and provides options to select flags, such as TF\_COMPONENT and TF\_DIAG.</span></span> <span data-ttu-id="41f13-136">Le service de journalisation centralisé conserve également les options de niveau de journalisation de OCSLogger.</span><span class="sxs-lookup"><span data-stu-id="41f13-136">Centralized Logging Service also retains the logging level options of OCSLogger.</span></span>

<span data-ttu-id="41f13-137">L’avantage le plus important de l’utilisation de Lync Server Management Shell sur le ClsController de ligne de commande est que vous pouvez configurer et définir de nouveaux scénarios à l’aide de fournisseurs sélectionnés ciblant l’espace problématique, les indicateurs personnalisés et les niveaux de connexion.</span><span class="sxs-lookup"><span data-stu-id="41f13-137">The most important advantage to using the Lync Server Management Shell over the command-line ClsController is that you can configure and define new scenarios using selected providers that target the problem space, custom flags, and logging levels.</span></span> <span data-ttu-id="41f13-138">Les scénarios accessibles à ClsController se limitent à ceux définis pour l’exécutable.</span><span class="sxs-lookup"><span data-stu-id="41f13-138">The scenarios available to ClsController are limited to those that are defined for the executable.</span></span>

<span data-ttu-id="41f13-p110">Dans les versions précédentes, OCSLogger.exe était fourni afin de permettre aux administrateurs et au personnel de support technique de recueillir des fichiers de suivi à partir d’ordinateurs du déploiement. Malgré tous ses atouts, il présentait toutefois un inconvénient : on ne pouvait recueillir des journaux que sur un seul ordinateur à la fois. Il était possible de se connecter à plusieurs ordinateurs à l’aide de copies distinctes d’OCSLogger, mais on se retrouvait alors avec plusieurs journaux et nulle méthode aisée pour agréger les résultats.</span><span class="sxs-lookup"><span data-stu-id="41f13-p110">In previous versions, OCSLogger.exe was provided to enable administrators and support personnel to collect trace files from computers in the deployment. OCSLogger, for all of its strengths, had a shortcoming. You could only collect logs on one computer at a given time. You could log on to multiple computers by using separate copies of OCSLogger, but you ended up with multiple logs and no easy way to aggregate the results.</span></span>

<span data-ttu-id="41f13-p111">Quand un utilisateur demande une recherche de journal, ClsController détermine à quel ordinateur envoyer la demande (en fonction des scénarios sélectionnés). Il détermine également si la recherche doit être envoyée au partage de fichiers où les fichiers .etl enregistrés se trouvent. Lorsque les résultats de la recherche sont renvoyés à ClsController, le contrôleur les fusionne en un jeu de résultats unique présenté à l’utilisateur. Les utilisateurs peuvent enregistrer les résultats de recherche sur leur ordinateur local afin d’effectuer une analyse approfondie.</span><span class="sxs-lookup"><span data-stu-id="41f13-p111">When a user requests a log search, the ClsController determines which machines to send the request to (that is, based on the scenarios selected). It also determines whether the search needs to be sent to the file share where the saved .etl files are located. When the search results are returned to the ClsController, the controller merges the results into a single time-ordered result set that is presented to the user. Users can save the search results to their local machine for further analysis.</span></span>

<span data-ttu-id="41f13-p112">Lorsque vous commencez une session de journalisation, vous spécifiez des scénarios adaptés au problème que vous tentez de résoudre. Vous pouvez exécuter deux scénarios simultanément. L’un d’entre eux doit être le scénario AlwaysOn. Comme son nom l’indique, il doit toujours être en cours d’exécution dans votre déploiement et recueillir des informations sur tous les ordinateurs, pools et composants.</span><span class="sxs-lookup"><span data-stu-id="41f13-p112">When you start a logging session, you specify scenarios that are relative to the problem that you are trying to resolve. You can have two scenarios running at any time. One of these two scenarios should be the AlwaysOn scenario. As the name implies, it should always be running in your deployment, collecting information on all computers, pools, and components.</span></span>

<div>


> [!IMPORTANT]  
> <span data-ttu-id="41f13-151">Par défaut, le scénario AlwaysOn ne s’exécute pas dans votre déploiement.</span><span class="sxs-lookup"><span data-stu-id="41f13-151">By default, the AlwaysOn scenario is not running in your deployment.</span></span> <span data-ttu-id="41f13-152">Vous devez le démarrer de manière explicite.</span><span class="sxs-lookup"><span data-stu-id="41f13-152">You must explicitly start the scenario.</span></span> <span data-ttu-id="41f13-153">Une fois démarré, il continue à s’exécuter jusqu’à ce que vous l’arrêtiez de manière explicite et l’état d’exécution est conservé entre les redémarrages de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="41f13-153">Once started, it will continue to run until explicitly stopped, and the running state will persist through reboots of the computers.</span></span> <span data-ttu-id="41f13-154">Pour plus d’informations sur les scénarios de démarrage et d’arrêt, voir <A href="lync-server-2013-using-start-for-the-centralized-logging-service-to-capture-logs.md">utilisation du menu Démarrer pour le service de journalisation centralisé pour capturer des journaux dans Lync server 2013</A> et <A href="lync-server-2013-using-stop-for-the-centralized-logging-service.md">utilisation du service de journalisation centralisé dans Lync Server 2013</A>.</span><span class="sxs-lookup"><span data-stu-id="41f13-154">For details on starting and stopping scenarios, see <A href="lync-server-2013-using-start-for-the-centralized-logging-service-to-capture-logs.md">Using Start for the Centralized Logging Service to capture logs in Lync Server 2013</A> and <A href="lync-server-2013-using-stop-for-the-centralized-logging-service.md">Using Stop for the Centralized Logging Service in Lync Server 2013</A>.</span></span>



</div>

<span data-ttu-id="41f13-p114">Lorsqu’un problème survient, démarrez un second scénario en rapport avec le problème signalé. Reproduisez le problème et arrêtez la journalisation pour le second scénario. Commencez vos recherches de journaux relatives au problème signalé. La collection agrégée de journaux génère un fichier journal qui contient des messages de suivi issus de tous les ordinateurs de l’étendue globale ou de site de votre déploiement. Si la recherche renvoie plus de données que vous ne pouvez raisonnablement en analyser (rapport signal-bruit où le bruit est trop élevé), exécutez une autre recherche avec des paramètres affinés. À ce stade, vous commencerez peut-être à remarquer certains modèles qui peuvent vous aider à appréhender plus étroitement le problème. Après deux ou trois recherches affinées, vous finirez par trouver des données pertinentes au problème et en déterminer la cause racine.</span><span class="sxs-lookup"><span data-stu-id="41f13-p114">When a problem occurs, start a second scenario that relates to the problem reported. Reproduce the problem, and stop the logging for the second scenario. Begin your log searches relative to the problem reported. The aggregated collection of logs produces a log file that contains trace messages from all computers in your site or global scope of your deployment. If the search returns more data than you can feasibly analyze (typically known as a signal-to-noise ratio, where the noise is too high), you run another search with narrower parameters. At this point, you can begin to notice patterns that show up and can help you get a clearer focus on the problem. Ultimately, after you perform a couple of refined searches you can find data that is relevant to the problem and figure out the root cause.</span></span>

<div>


> [!TIP]  
> <span data-ttu-id="41f13-162">Lorsque vous avez présenté un scénario de problème dans Lync Server, commencez par vous demander « que dois-je savoir déjà à propos du problème ».</span><span class="sxs-lookup"><span data-stu-id="41f13-162">When presented with a problem scenario in Lync Server, start by asking yourself “What do I already know about the problem?”</span></span> <span data-ttu-id="41f13-163">Si vous quantifiez les limites du problème, vous pouvez éliminer une partie importante des entités opérationnelles de Lync Server.</span><span class="sxs-lookup"><span data-stu-id="41f13-163">If you quantify the problem boundaries, you can eliminate a large part of the operational entities in Lync Server.</span></span><BR><span data-ttu-id="41f13-164">Considérez un exemple de scénario dans lequel vous savez que les utilisateurs n’obtiennent pas de résultats à jour lors de la recherche d’un contact.</span><span class="sxs-lookup"><span data-stu-id="41f13-164">Consider an example scenario where you know that users are not getting current results when looking for a contact.</span></span> <span data-ttu-id="41f13-165">Il n’est pas possible de rechercher les problèmes liés aux composants multimédias, à la voix entreprise, aux conférences et à un certain nombre d’autres composants.</span><span class="sxs-lookup"><span data-stu-id="41f13-165">There is no point in looking for problems in the media components, Enterprise Voice, conferencing, and a number of other components.</span></span> <span data-ttu-id="41f13-166">Vous ignorez peut-être toutefois où réside réellement le problème : sur le client ou du côté serveur ?</span><span class="sxs-lookup"><span data-stu-id="41f13-166">What you may not know is where the problem actually is: on the client, or is this a server-side problem?</span></span> <span data-ttu-id="41f13-167">Les contacts sont collectés auprès d’Active Directory par le réplicateur d’utilisateurs et remis au client par le biais du serveur du carnet d’adresses.</span><span class="sxs-lookup"><span data-stu-id="41f13-167">Contacts are collected from Active Directory by the User Replicator and delivered to the client by way of the Address Book Server (ABServer).</span></span> <span data-ttu-id="41f13-168">ABServer obtient ses mises à jour à partir de la base de données RTC (où elles ont été écrites par le réplicateur d’utilisateurs) et les rassemble dans des fichiers de carnet d’adresses, par défaut à 01h30.</span><span class="sxs-lookup"><span data-stu-id="41f13-168">The ABServer gets its updates from the RTC database (where User Replicator wrote them) and collects them into address book files, by default – 1:30 AM.</span></span> <span data-ttu-id="41f13-169">Les clients du serveur Lync récupèrent le nouveau carnet d’adresses sur une planification aléatoire.</span><span class="sxs-lookup"><span data-stu-id="41f13-169">The Lync Server clients retrieve the new address book on a randomized schedule.</span></span> <span data-ttu-id="41f13-170">Étant donné que vous savez le fonctionnement du processus, vous pouvez limiter votre recherche à la cause potentielle d’un problème lié aux données collectées auprès d’Active Directory par le réplicateur d’utilisateurs, l’élément absent ne récupérant pas les fichiers du carnet d’adresses, ou les clients non Téléchargement du fichier du carnet d’adresses.</span><span class="sxs-lookup"><span data-stu-id="41f13-170">Because you know how the process works, you can reduce your search for the potential cause to an issue related to data being collected from Active Directory by the User Replicator, the ABServer not retrieving and creating the address book files, or the clients not downloading the address book file.</span></span>



</div>

</div>

<span> </span>

</div>

</div>

</div>

